<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TF2 ê±°ë˜ ê³„ì‚°ê¸°</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    min-height: 100vh;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding: 16px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  }
  .card {
    width: 100%; max-width: 480px;
    background: rgba(255,255,255,0.05);
    backdrop-filter: blur(20px);
    border-radius: 24px;
    border: 1px solid rgba(255,255,255,0.1);
    overflow: hidden;
    box-shadow: 0 25px 60px rgba(0,0,0,0.5);
  }
  .header {
    background: linear-gradient(135deg, #e94560 0%, #c23152 100%);
    padding: 24px 24px 18px;
  }
  .header-top { display: flex; align-items: center; justify-content: space-between; }
  .header h1 { font-size: 20px; font-weight: 700; color: #fff; letter-spacing: -0.3px; }
  .header .sub { margin-top: 4px; font-size: 12px; color: rgba(255,255,255,0.75); }
  .settings-btn {
    background: rgba(255,255,255,0.15); border: none; border-radius: 12px;
    padding: 9px 14px; cursor: pointer; color: #fff; font-size: 13px; font-weight: 600;
    transition: all 0.2s;
  }
  .settings-btn:hover, .settings-btn.active { background: rgba(255,255,255,0.25); }
  .badges { display: flex; gap: 8px; margin-top: 14px; flex-wrap: wrap; }
  .badge {
    background: rgba(255,255,255,0.2); padding: 4px 11px; border-radius: 20px;
    font-size: 11px; color: #fff; font-weight: 500; white-space: nowrap;
  }
  .badge.live {
    background: rgba(16,185,129,0.3); border: 1px solid rgba(16,185,129,0.4);
  }
  .updated-info {
    margin-top: 10px; font-size: 10px; color: rgba(255,255,255,0.4);
  }

  .settings-panel {
    background: rgba(233,69,96,0.08);
    border-bottom: 1px solid rgba(233,69,96,0.15);
    padding: 18px 24px;
    display: none;
  }
  .settings-panel.show { display: block; }
  .settings-row { display: flex; gap: 12px; }
  .settings-row > div { flex: 1; }
  .settings-row label {
    display: block; font-size: 11px; font-weight: 600;
    color: rgba(255,255,255,0.6); margin-bottom: 6px;
    text-transform: uppercase; letter-spacing: 0.5px;
  }
  .settings-row .hint {
    font-size: 10px; color: rgba(255,255,255,0.35); margin-top: 4px;
  }
  .settings-row input {
    width: 100%; padding: 9px 12px; border-radius: 10px;
    border: 1px solid rgba(233,69,96,0.3); background: rgba(255,255,255,0.08);
    color: #fff; font-size: 15px; font-weight: 600; outline: none;
  }
  .settings-row input:focus { border-color: rgba(233,69,96,0.6); }
  .settings-row input.auto { border-color: rgba(16,185,129,0.4); background: rgba(16,185,129,0.06); }

  .body { padding: 22px 24px; }
  .field { margin-bottom: 14px; }
  .field-label {
    display: flex; align-items: center; gap: 6px;
    font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.5);
    margin-bottom: 7px; text-transform: uppercase; letter-spacing: 0.5px;
  }
  .field-icon {
    width: 22px; height: 22px; border-radius: 6px;
    display: flex; align-items: center; justify-content: center; font-size: 12px;
  }
  .field input {
    width: 100%; padding: 13px 16px; border-radius: 14px;
    border: 2px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04);
    color: #fff; font-size: 20px; font-weight: 700; outline: none; transition: all 0.2s;
  }
  .field input::placeholder { color: rgba(255,255,255,0.2); font-weight: 400; font-size: 14px; }
  .field input:focus { background: rgba(255,255,255,0.06); }
  .field.metal input:focus { border-color: #f59e0b; background: rgba(245,158,11,0.08); }
  .field.keys input:focus { border-color: #8b5cf6; background: rgba(139,92,246,0.08); }
  .field.won input:focus { border-color: #10b981; background: rgba(16,185,129,0.08); }

  .divider {
    display: flex; align-items: center; justify-content: center;
    margin: 2px 0; gap: 8px;
  }
  .divider .line { flex: 1; height: 1px; background: rgba(255,255,255,0.08); }
  .divider span { font-size: 14px; color: rgba(255,255,255,0.25); }

  .clear-btn {
    width: 100%; margin-top: 20px; padding: 13px; border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05);
    color: rgba(255,255,255,0.6); font-size: 13px; font-weight: 600;
    cursor: pointer; transition: all 0.2s;
  }
  .clear-btn:hover { background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.8); }

  .footer {
    border-top: 1px solid rgba(255,255,255,0.06);
    padding: 14px 24px 18px; background: rgba(0,0,0,0.15);
  }
  .footer-title {
    margin-bottom: 10px; font-size: 11px; font-weight: 600;
    color: rgba(255,255,255,0.35); text-transform: uppercase; letter-spacing: 0.5px;
  }
  .quick-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .quick-btn {
    padding: 9px 8px; border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.04);
    cursor: pointer; text-align: center; transition: all 0.2s;
  }
  .quick-btn:hover { background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.15); }
  .quick-btn .ql { font-size: 10px; color: rgba(255,255,255,0.45); margin-bottom: 2px; }
  .quick-btn .qv { font-size: 13px; font-weight: 700; }
</style>
</head>
<body>
<div class="card">
  <div class="header">
    <div class="header-top">
      <div>
        <h1>TF2 ê±°ë˜ ê³„ì‚°ê¸°</h1>
        <p class="sub">í‚¤ Â· ì •ì œê¸ˆì† Â· ì›í™” ì‹¤ì‹œê°„ í™˜ì‚°</p>
      </div>
      <button class="settings-btn" onclick="toggleSettings(this)">âš™ï¸ í™˜ìœ¨ ì„¤ì •</button>
    </div>
    <div class="badges" id="badges"></div>
    <div class="updated-info" id="updatedInfo"></div>
  </div>

  <div class="settings-panel" id="settingsPanel">
    <div class="settings-row">
      <div>
        <label>ğŸ”‘ 1í‚¤ ê°€ê²© (ì›)</label>
        <input type="number" id="keyPrice" value="" oninput="onSettingChange()">
        <div class="hint">ìˆ˜ë™ ì…ë ¥</div>
      </div>
      <div>
        <label>âš™ï¸ 1í‚¤ë‹¹ ì •ì œê¸ˆì†</label>
        <input type="number" id="metalPerKey" value="" class="auto" oninput="onSettingChange()">
        <div class="hint">backpack.tf ìë™ ì—°ë™</div>
      </div>
    </div>
  </div>

  <div class="body">
    <div class="field metal">
      <div class="field-label">
        <span class="field-icon" style="background:#f59e0b">âš™ï¸</span>
        ì •ì œê¸ˆì† (Refined Metal)
      </div>
      <input type="text" inputmode="decimal" id="metalInput"
             placeholder="ì •ì œê¸ˆì† ìˆ˜ëŸ‰ ì…ë ¥..." oninput="calc('metal')" onfocus="af='metal'">
    </div>
    <div class="divider"><div class="line"></div><span>â†•</span><div class="line"></div></div>
    <div class="field keys">
      <div class="field-label">
        <span class="field-icon" style="background:#8b5cf6">ğŸ”‘</span>
        í‚¤ (Keys)
      </div>
      <input type="text" inputmode="decimal" id="keysInput"
             placeholder="í‚¤ ìˆ˜ëŸ‰ ì…ë ¥..." oninput="calc('keys')" onfocus="af='keys'">
    </div>
    <div class="divider"><div class="line"></div><span>â†•</span><div class="line"></div></div>
    <div class="field won">
      <div class="field-label">
        <span class="field-icon" style="background:#10b981;color:#fff;font-weight:800;font-size:13px">â‚©</span>
        ì›í™” (KRW)
      </div>
      <input type="text" inputmode="decimal" id="wonInput"
             placeholder="ì›í™” ê¸ˆì•¡ ì…ë ¥..." oninput="calc('won')" onfocus="af='won'">
    </div>
    <button class="clear-btn" onclick="clearAll()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
  </div>

  <div class="footer">
    <div class="footer-title">ë¹ ë¥¸ ì°¸ì¡° <span style="font-weight:400;color:rgba(255,255,255,0.25)">(backpack.tf ì—°ë™)</span></div>
    <div class="quick-grid">
      <button class="quick-btn" id="todBtn" onclick="quickFill(todMetal)">
        <div class="ql">ToD Ticket</div>
        <div class="qv" style="color:#8b5cf6" id="todRefVal">â€” ref</div>
      </button>
      <button class="quick-btn" id="keyRefBtn" onclick="quickFill(getM())">
        <div class="ql">í‚¤ 1ê°œ</div>
        <div class="qv" style="color:#10b981" id="keyRefVal">â€” ref</div>
      </button>
    </div>
  </div>
</div>

<script>
let af = null;
let todMetal = '0';
const $ = id => document.getElementById(id);
const getKP = () => parseFloat($('keyPrice').value) || 0;
const getMP = () => parseFloat($('metalPerKey').value) || 0;
const getM = () => String(getMP());

function fmt(n) {
  if (n === 0) return '0';
  if (Math.abs(n) < 0.01) return n.toFixed(4);
  if (Number.isInteger(n)) return n.toLocaleString('ko-KR');
  return parseFloat(n.toFixed(2)).toLocaleString('ko-KR', { maximumFractionDigits: 2 });
}

function updateBadges() {
  const kp = getKP(), mp = getMP();
  const ppm = mp > 0 ? (kp / mp).toFixed(2) : '0';
  $('badges').innerHTML =
    `<span class="badge">ğŸ”‘ 1í‚¤ = ${kp.toLocaleString()}ì›</span>` +
    `<span class="badge live">âš™ï¸ 1í‚¤ = ${mp} ref</span>` +
    `<span class="badge">â‚© 1 ref â‰ˆ ${ppm}ì›</span>`;
  $('keyRefVal').textContent = mp + ' ref';
}

function updateTimestamp(ts) {
  if (!ts) { $('updatedInfo').textContent = ''; return; }
  const d = new Date(ts);
  const diff = Math.floor((Date.now() - d.getTime()) / 60000);
  let ago;
  if (diff < 1) ago = 'ë°©ê¸ˆ ì „';
  else if (diff < 60) ago = diff + 'ë¶„ ì „';
  else if (diff < 1440) ago = Math.floor(diff / 60) + 'ì‹œê°„ ì „';
  else ago = Math.floor(diff / 1440) + 'ì¼ ì „';
  $('updatedInfo').innerHTML = `ğŸ“¡ backpack.tf ê¸°ì¤€ Â· ${ago} ì—…ë°ì´íŠ¸`;
}

function calc(src) {
  const kp = getKP(), mp = getMP();
  if (src === 'metal') {
    const v = parseFloat($('metalInput').value);
    if (isNaN(v)) { $('keysInput').value = ''; $('wonInput').value = ''; return; }
    $('keysInput').value = mp > 0 ? fmt(v / mp) : '0';
    $('wonInput').value = mp > 0 ? fmt(Math.round(v / mp * kp)) : '0';
  } else if (src === 'keys') {
    const v = parseFloat($('keysInput').value);
    if (isNaN(v)) { $('metalInput').value = ''; $('wonInput').value = ''; return; }
    const m = v * mp;
    $('metalInput').value = fmt(m);
    $('wonInput').value = fmt(Math.round(v * kp));
  } else {
    const v = parseFloat($('wonInput').value.replace(/,/g, ''));
    if (isNaN(v)) { $('metalInput').value = ''; $('keysInput').value = ''; return; }
    const keys = kp > 0 ? v / kp : 0;
    $('keysInput').value = fmt(keys);
    $('metalInput').value = fmt(keys * mp);
  }
}

function onSettingChange() {
  updateBadges();
  if (af) calc(af);
}

function clearAll() {
  $('metalInput').value = '';
  $('keysInput').value = '';
  $('wonInput').value = '';
  af = null;
}

function quickFill(val) {
  $('metalInput').value = val;
  af = 'metal';
  calc('metal');
  $('metalInput').focus();
}

function toggleSettings(btn) {
  const p = $('settingsPanel');
  const show = !p.classList.contains('show');
  p.classList.toggle('show', show);
  btn.classList.toggle('active', show);
}

// config.jsonì—ì„œ í™˜ìœ¨ ë¡œë“œ (GitHub Actionsê°€ ìë™ ì—…ë°ì´íŠ¸)
fetch('config.json')
  .then(r => r.json())
  .then(c => {
    $('keyPrice').value = c.keyPriceKRW;
    $('metalPerKey').value = c.metalPerKey;
    todMetal = String(c.todTicketMetal);
    $('todRefVal').textContent = c.todTicketMetal + ' ref';
    updateBadges();
    updateTimestamp(c.lastUpdated);
  })
  .catch(() => {
    // fallback
    $('keyPrice').value = 3300;
    $('metalPerKey').value = 56;
    todMetal = '27';
    $('todRefVal').textContent = '27 ref';
    updateBadges();
  });
</script>
</body>
</html>
